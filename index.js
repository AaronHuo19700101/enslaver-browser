"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function asyncGeneratorStep(e,t,r,o,n,i,s){try{var a=e[i](s),c=a.value}catch(e){return void r(e)}a.done?t(c):Promise.resolve(c).then(o,n)}function _asyncToGenerator(a){return function(){var e=this,s=arguments;return new Promise(function(t,r){var o=a.apply(e,s);function n(e){asyncGeneratorStep(o,t,r,n,i,"next",e)}function i(e){asyncGeneratorStep(o,t,r,n,i,"throw",e)}n(void 0)})}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),e}function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{},o=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),o.forEach(function(e){_defineProperty(t,e,r[e])})}return t}function _objectWithoutPropertiesLoose(e,t){if(null==e)return{};var r,o,n={},i=Object.keys(e);for(o=0;o<i.length;o++)r=i[o],0<=t.indexOf(r)||(n[r]=e[r]);return n}function _objectWithoutProperties(e,t){if(null==e)return{};var r,o,n=_objectWithoutPropertiesLoose(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(o=0;o<i.length;o++)r=i[o],0<=t.indexOf(r)||Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_nonIterableSpread()}function _arrayWithoutHoles(e){if(Array.isArray(e)){for(var t=0,r=new Array(e.length);t<e.length;t++)r[t]=e[t];return r}}function _iterableToArray(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}Object.defineProperty(exports,"__esModule",{value:!0});var Uri=function(){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"";_classCallCheck(this,t),_defineProperty(this,"origin",""),this.origin=e}return _createClass(t,[{key:"route",get:function(){return{protocol:t.decodeProtocol(this.origin),query:t.decodeQuery(this.origin),hash:t.decodeHash(this.origin)}}}],[{key:"decodeProtocol",value:function(e){var t=decodeURIComponent(e).match(/^(\S+):\/\//i);return t&&t[1]?t[1]:""}},{key:"decodeQuery",value:function(e){var t=decodeURIComponent(e).match(/\?([^#]+)#?/i);if(!t||!t[1])return null;var r=t[1].split("&").reduce(function(e,t){var r=t.split("=");return r[0]&&r[1]&&(e[r[0]]=r[1]),e},{});return Object.keys(r).length?r:{}}},{key:"decodeHash",value:function(e){var t=decodeURIComponent(e).match(/#(\S+)/i);return t&&t[1]?t[1]:""}},{key:"encodeQuery",value:function(n){var i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"?",e=Object.keys(n);return e.length?e.reduce(function(e,t,r){var o=r?"&":i;return"".concat(e).concat(o).concat(t,"=").concat(n[t])},""):""}},{key:"encodeHash",value:function(e){return e?"#".concat(e):""}},{key:"encodeProtocol",value:function(e){return e?"".concat(e,"://"):""}}]),t}(),Http=function(){function t(e){var c=this;_classCallCheck(this,t),_defineProperty(this,"baseURI",""),_defineProperty(this,"baseHeaders",{}),_defineProperty(this,"baseInit",{}),_defineProperty(this,"successAOP",function(e){return e}),_defineProperty(this,"errorAOP",function(e){throw e}),_defineProperty(this,"handleInit",function(e){var t=e.method,r=e.headers,o=void 0===r?{}:r,n=e.body,i=_objectWithoutProperties(e,["method","headers","body"]),s=c.handleHeaders(o),a=n;return"object"!==_typeof(n)||n instanceof FormData||(a=JSON.stringify(n),s.append("Content-Type","application/json")),_objectSpread(n?{method:t,headers:s,body:a}:{method:t,headers:s},c.baseInit,i)}),this.init(e)}var r;return _createClass(t,[{key:"init",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.baseURI,r=void 0===t?this.baseURI:t,o=e.baseHeaders,n=void 0===o?this.baseHeaders:o,i=e.baseInit,s=void 0===i?this.baseInit:i,a=e.errorAOP,c=void 0===a?this.errorAOP:a,u=e.successAOP,h=void 0===u?this.successAOP:u;this.baseURI=r,this.baseHeaders=n,this.baseInit=s,this.errorAOP=c,this.successAOP=h}},{key:"handleURI",value:function(e){return new Uri(e).route.protocol?e:"".concat(this.baseURI).concat(e)}},{key:"handleHeaders",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return new Headers(_objectSpread({},this.baseHeaders,e))}},{key:"handleResponse",value:function(e){var t=e.json();return e.ok?t.catch(function(){return console.warn("请求成功，返回结果不是JSON数据."),{}}):t.then(function(e){throw e})}},{key:"handleRequest",value:(r=_asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,o,n,i,s,a,c,u,h;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.uri,o=t.method,n=void 0===o?"GET":o,i=t.headers,s=void 0===i?{}:i,a=t.body,c=_objectWithoutProperties(t,["uri","method","headers","body"]),e.next=3,fetch(this.handleURI(r),this.handleInit(_objectSpread({method:n,headers:s,body:a},c)));case 3:return u=e.sent,e.prev=4,e.next=7,this.handleResponse(u);case 7:return h=e.sent,e.abrupt("return",this.successAOP(h));case 11:return e.prev=11,e.t0=e.catch(4),e.abrupt("return",this.errorAOP(e.t0));case 14:case"end":return e.stop()}},e,this,[[4,11]])})),function(e){return r.apply(this,arguments)})},{key:"get",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},r=t.headers,o=_objectWithoutProperties(t,["headers"]);return this.handleRequest(_objectSpread({method:"GET",uri:e,headers:r},o))}},{key:"delete",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},r=t.headers,o=_objectWithoutProperties(t,["headers"]);return this.handleRequest(_objectSpread({method:"DELETE",uri:e,headers:r},o))}},{key:"post",value:function(e,t){var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},o=r.headers,n=_objectWithoutProperties(r,["headers"]);return this.handleRequest(_objectSpread({method:"POST",uri:e,body:t,headers:o},n))}},{key:"patch",value:function(e,t){var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},o=r.headers,n=_objectWithoutProperties(r,["headers"]);return this.handleRequest(_objectSpread({method:"PATCH",uri:e,body:t,headers:o},n))}},{key:"put",value:function(e,t){var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},o=r.headers,n=_objectWithoutProperties(r,["headers"]);return this.handleRequest(_objectSpread({method:"PUT",uri:e,body:t,headers:o},n))}}]),t}(),Socket=function(){function r(e){_classCallCheck(this,r),_defineProperty(this,"source",""),_defineProperty(this,"socket",null),_defineProperty(this,"events",{}),_defineProperty(this,"lifehook",{beforeOpen:function(){},onopen:function(){},onerror:function(){},onmessage:function(){},oncloses:function(){}}),this.init(e)}return _createClass(r,[{key:"init",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.source,r=void 0===t?this.source:t,o=e.lifehook,n=void 0===o?this.lifehook:o;this.source=r,this.lifehook=_objectSpread({},this.lifehook,n),this.lifehook.beforeOpen()}},{key:"connect",value:function(e){var t=this;this.init(e),this.socket=new WebSocket(this.source),this.socket.onopen=this.lifehook.onopen,this.socket.onclose=this.lifehook.onclose,this.socket.onerror=this.lifehook.onerror,this.socket.onmessage=function(e){return r.onMessage(t,e)}}},{key:"on",value:function(e,t){var r=2<arguments.length&&void 0!==arguments[2]&&arguments[2];this.events[e]=this.events[e]||[],this.events[e]=r?[t]:_toConsumableArray(this.events[e]).concat([t])}},{key:"off",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;this.events[e]=null!==t?this.events[e].filter(function(e){return e!==t}):[]}},{key:"emit",value:function(e){var t=_objectSpread({event:e},1<arguments.length&&void 0!==arguments[1]?arguments[1]:{}),r=JSON.stringify(t);this.socket.send(r)}},{key:"close",value:function(){var e;(e=this.socket).close.apply(e,arguments)}}],[{key:"onMessage",value:function(e,t){var r=t.data,o=JSON.parse(r);e.lifehook.onmessage(o);var n=o.event;e.events[n]&&e.events[n].length&&e.events[n].forEach(function(e){return e(o)})}}]),r}();exports.Http=Http,exports.Socket=Socket,exports.Uri=Uri;
